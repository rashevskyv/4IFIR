# Гайд по настройке 4IFIR WIZARD

1. [RAM](#RAM)
2. [Дополнительные оптимизации](#дополнительные-оптимизации) 
1. [4ifir Optimised (ECO режим)](#профиль-emc-4ifir-optimised)

***
## Советы перед настройкой
* Используйте EMUNAND
* Сделайте бекап сохранений 
* Установите игры для проверки стабильности настроек
* Текущие параметры, установленные в 4IFIR WIZARD, хранятся в файле atmosphere\kips\loader.kip
* Если после изменения какого-то из параметров перестала включаться консоль -  используйте KipTool для отката изменений.
Инструкцию по и использованию можно найти на [странице проекта](https://github.com/kawaii-flesh/KipTool)
* Если консоль не запускается после настройки в **4IFIR Wizard**, можно заменить файл `atmosphere/kips/loader.kip` на бэкап вашего предыдущего кипа, *не забудьте переименовать файл бэкапа в `loader.kip`*. Бэкапы кипов находятся в папке `atmosphere/kips/.bak` (включите невидимые папки в проводнике). Если бэкапов нет, можно достать стандартный `loader.kip` с вашей версии 4IFIR в папке `atmosphere/kips/loader.kip`.  
* Следует установить HB Menu как приложение (находится в папке games, в корне карты памяти, или [.nsp файл по ссылке](https://t.me/kf4fr/48074/547847)). Далее все манипуляции и тесты следует проводить именно в нем.  
>**Запускать с жатой кнопкой **R**. Дождаться пока загрузится HB Menu. Отпусть кнопку **R****
* Для проверки параметров на стабильность, сначала запускаем - MicroMemBench. Если все ОК, то можно переходить к тестам в игре.
* Для проверки стабильности можно использовать бенчмарк [Ultracam для Zelda TOTK](https://t.me/kf4fr/48074/765475)    
(Бенчмарк очень хорошо нагружает RAM, достаточно будет 2х проходов)  
* Так же хорошо подойдет Red Dead Redemption.
Для большей нагрузки, можно перевести консоль в docked mode с помощью ReversNX. Для каждого теста будет достаточно 15-20 минут игры.
***

### RAM
Для начала стоит определиться со сценарием использования консоли, от этого и будет зависеть выбор частоты RAM  
1. Эко режим  - для 30 фпс с низким потреблением. Частоты до 2000 Mhz; Не совсем уверен, есть ли смысл его сейчас настраивать, так как есть профиль RAM 4IFIR optimized E, при должной настройки, у него не плохая производительность (об этом чуть позже)
2. Сбалансированый - это 60 фпс (не всегда стабильных), но с приемлемым потреблением. Частоты 2100 - 2400 Mhz будут оптимальным выбором для такого сценария
3. Максимальная производительность - режим для игры в доке; тут может быть любая частота от 2400 и до скольки получится
Если выбраная вами частота не заводится - попробуйте вручную повысить eBalance (eBal), чем выше значение eBal, тем выше частоту можно взять.
***
**Переходим в 4advanced - RAM**  
* RAM Mhz – выбор частоты памяти, которая будет доступна в меню разгона приставки **4IFIR Houdini>Edit app profile>EMC>4IFIR Optimized S.**  
>1. Выбираем нужную частоту, перезагружаемся 
>2. После загрузки активируем разгон памяти:  
>4IFIR Houdini -> Temporary overrides -> Memory -> 4IFIR Optimized S  
>Это временный разгон, который слетит после перезагрузки.    
>В шапке оверлея в графе MEM: *xxxx*MHz должно появиться ваше значение. Если все в порядке и консоль не зависла - идём дальше, если нет - жмём кнопку питания консоли 12 секунд до выключения, грузимся через хекату в сейф-мод и выбираем значение RAM в Wizard на ступень ниже.    
>3. Тестируем на стабильность в MemBench - прогнать несколько раз и зафиксировать значения  
>4. Тестируем в течение 10-15 минут в чувствительных к RAM играх (RDR или Ultracam для Zelda TOTK).
>5. Если все хорошо (нет артефактов и зависаний), переходим дальше. Если нет - выбираем частоту RAM на ступень ниже.
* EMC Balance – набор оптимизаций работы памяти в соотношении энергоэффективность производительность.    
*(Чем выше eBAL, тем выше можно взять частоту RAM)*      
>По умолчанию установлено значение **0 - eBamatic** - 4IFIR автоматически подбирает подходящий EMC Balance для выбранной частоты.   
>1 - Этот режим имеет максимальную производительность, но за счет более высокого VDD2, по сравнению с 2м режимом. Профитнее всего его использовать на низких чатотах RAM (до **2000mhz**) так как повышеный вольтаж, не сильно влияет   
>2 - Это Менее производительный, но более экономный (в сравнении с eBal 1); Маст-хэв для частот, **выше 2000 Mhz**  
>3 - Это Менее производительный (в сравнении с eBal 2), но позволяет взять выше частоту RAM  
>4 - Это Менее производительный (в сравнении с eBal 3), но позволяет взять еще выше частоту RAM     
>**Чем ниже значение, тем больше преимуществ вы получаете (увеличится пропускная способность памяти, что является мерилом производительности свича).**       
>1. Выбираем значение EMC Balance, перезагружаемся 
>2. После загрузки активируем разгон памяти:  
>4IFIR Houdini -> Temporary overrides -> Memory -> 4IFIR Optimized S  
>Это временный разгон, который слетит после перезагрузки.    
>3. Тестируем на стабильность в MemBench - прогнать несколько раз и зафиксировать значения  
>4. Тестируем в течение 10-15 минут в чувствительных к RAM играх (RDR или Ultracam для Zelda TOTK).
>5. Если все хорошо (нет артефактов и зависаний), переходим дальше. Если нет - выбираем EMC Balance на ступень выше.      
* RAM Vddq – Напряжение питания памяти.   
*(Чем ниже значение, тем ниже потребление)*
>ВАЖНО!!! 
>1. Не опускайте слишком низко этот параметр, сильного профита не будет, но есть риск отвала EmuNand
>2.  Перед настройкой нового кипа, сбрасывайте этот параметр в дефолт, чтобы минимизировать риск отвала EmuNand
>
>Настройка:
>* Поочередно снижаете значения на шаг вниз и тестируете на стабильность.  
* RAM Vdd2 – Выбор максимального порога потребления памяти.   
*(Чем ниже значение, тем ниже потребление)*
>Примечание:
>Если вы хотите максимальную производительность на текущей частоте RAM - настраивайте этот параметр **после настройки таймингов**, так как тайминги зависимы от Vdd2
>
>Настройка:
>* Поочередно снижаете значения на шаг вниз и тестируете на стабильность.
* Eba-shift - Корректировка eBal режима  
*(Чем ниже значение (EMC Ballance – Eba-shift), тем выше можно поднять tWTP (8) тайминг)* 
>1. Выбираем значение Eba-shift - 1, перезагружаемся 
>2. После загрузки активируем разгон памяти:  
>4IFIR Houdini -> Temporary overrides -> Memory -> 4IFIR Optimized S  
>Это временный разгон, который слетит после перезагрузки.    
>3. Тестируем в MemBench - фиксируем значение пропускной способности.
>3.  Выбираем значение Eba-shift - 2, перезагружаемся.
>3. Тестируем в MemBench - фиксируем новое значение пропускной способности, если пропускная выросла - продолжаем поднимать значение Eba-shift. 
>3. Устанавливаем Eba-shift на то значение, на котором была максимальная пропускная способность.
>4. Тестируем в течение 10-15 минут в чувствительных к RAM играх (RDR или Ultracam для Zelda TOTK).
>5. Если все хорошо (нет артефактов и зависаний), переходим дальше. Если нет - выбираем Eba-shift на ступень ниже.         
* EMC DVB Mode - Эта настройка управляет внутренним адаптивным механизмом контроллера оперативной памяти. Выбор более точного значения потребления.     
*(Чем ниже значение, тем ниже потребление)*
>0. По умолчанию стоит eBamatic.
> 2. Запускаем игру (RDR или Zelda TOTK)
> 3. Убедившись, что стоит профиль **EMC - 4IFIR Optimised S**. Заходим в InfoNX, Смотрим значение в пункте **SOC voltage**, это будет отправной точкой для настройки.
>1. Выбираем значение EMC DVB Mode, соответствующее тому, что мы определили в предыдущем пункте,  перезагружаемся 
>2. После загрузки активируем разгон памяти:  
>4IFIR Houdini -> Temporary overrides -> Memory -> 4IFIR Optimized S    
>4. Тестируем в течение 10-15 минут в чувствительных к RAM играх (RDR или Ultracam для Zelda TOTK).
>5. Если все хорошо (нет артефактов и зависаний), пробуем опустить значение. Если нет - выбираем EMC DVB Mode на шаг выше.         
* Core Timings – Настройка таймингов памяти.  
Актуальный вариант настройки таймингов в режиме реального времени через - [**EMC Magician**](EMC_MAGICIAN.md)
>**Информация для справки, если кто-то захочет настроить тайминги по старому методу**  
>Имеется восемь таймингов Core Timings 1–8. Тайминги не влияют друг на друга. Настройте каждый параметр по отдельности для достижения максимальной стабильной производительности. Чем выше значение каждого тайминга, тем выше производительность.    
>Начинаем с теста в MemBench - фиксируем результат. Переходим к первому таймингу, повышаем его на один шаг, перезапускаем консоль, тестируем в MemBench несколько раз и фиксируем новый результат, если показатель в MemBench улучшился, то продолжаем повышать и тестировать.
>Когда достигаем значения, при котором консоль начинает работать нестабильно, зависать или вылетать, возвращаемся к предыдущему значению и переходим к тесту в играх. Также может существовать порог, при котором дальнейшее повышение значения тайминга не даст никакого результата. (погрешность в 30-40 мб/с можно не учитывать, так как может быть ситуация: на значении 4 - 7650мб/с; на 5 - 7610мб/с; а на 6 значении может стать -7690мб/с. Но к примеру, если на 5м значении показатели упадут, до 7100мбс, тогда уже имеет смысл остаться на 4). На этом значении можно переходить к следующему таймингу. Остальные тайминги настраиваются по тому же алгоритму.
***

### Дополнительные оптимизации
**Применив эти настройки можно добиться прироста до 500 мб/с**
* **Smart mode - QuickTune - eBamatic - e.BAMATIC Stage** - выбор уровня оптимизаций eBamatic. Чем выше значение, тем агрессивнее оптимизация.

>Поочередно повышаете значения на шаг и тестируете на стабильность. MemBench + Игра  
* **4ekate** – Бесплатный прирост (около 200 мб/с)    
*(Работает не у всех, могут появиться проблемы с выходом консоли из сна)*
> 1. Открывает HB Menu > All in on updater
> 2. Сторонние загрузки > 4ekate
> 3. На вопрос о перезаписи ini отвечаем - ДА
> 4. Перезагрузка
> 5. Если после этого, консоль перестала выходить из сна - переустанавливаем 4IFIR через All in on updater

***

### Профиль EMC-4ifir Optimised

Настройки для режима **EMC-4IFIR Optimized**  
* sMeh 8 - стейджи эффективности памяти в режиме Optimized. Чем выше значение, тем больше производительности.   
>Данный пункт стоит сразу поставить в значение **2**, это даст серьезный прирост для 4IFIR Optimized режима. 
* pMeh 19 - GPU vMin для 4ifir Optimised (Чем выше значение, тем ниже минимальный вольтаж, для мониторинга значений используйте InfoNX)
>Настройка данного пункта описана в разделе Undervolt GPU/CPU 
* pMeh 20 - VDDQ/VDD2 для 4ifir Optimised (Чем выше значение, тем выше вольтаж, для мониторинга значений используйте InfoNX)
>Принцип настройки и тестирования такой же, как и для **EMC-4IFIR Optimized S**, только во время тестов, нужно включать профиль **EMC-4IFIR Optimized**

